<!doctype html>
<html lang="en-ca" theme="cherries">
	<meta charset="utf-8" />
	<title>op-xy party</title>
	<meta name="description" content="create an op-xy kit" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="/defaults.css" />
	<link rel="stylesheet" href="drum.css" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="application-name" content="op-xy party" />
	<meta name="apple-mobile-web-app-title" content="op-xy party" />
	<meta name="theme-color" content="#000000" />
	<meta property="og:title" content="op-xy party" />
	<meta property="og:description" content="for op-xy" />
	<meta property="og:image" content="/aux/apple-touch-icon.png" />
	<meta name="twitter:card" content="summary" />
	<link rel="apple-touch-icon" href="/aux/apple-touch-icon.png" />
	<link rel="manifest" href="/aux/app.webmanifest" />

	<deluge-kit>
		<template shadowrootmode="open">
			<h1>op-xy preset maker</h1>
			<header>
				<label>
					<input type="text" value="new kit" id="name" />
				</label>
				<deluge-button id="add" label="+ add sounds"></deluge-button>
				<deluge-button id="download" label="download"> </deluge-button>

				<label style="font-size: 0.8em">
					<midi-port direction="input" software=""></midi-port>
				</label>

				<label>
					multisampler
					<input type="checkbox" id="multisampler" />
				</label>
			</header>

			<deluge-sources></deluge-sources>

			<style>
				h1 {
					margin: 0;
					font-size: 1rem;
				}
				header {
					display: flex;
					align-items: end;
					gap: 1em;
				}

				#add {
					margin-top: 1rem;
				}

				#name {
					display: block;
				}

				deluge-sources {
					display: flex;
					flex-direction: column;
				}

				deluge-sound {
					margin-top: 1rem;
				}

				label {
					display: flex;
					flex-direction: column;
				}

				deluge-sound:nth-child(n + 25) {
					background: red;
					box-shadow: 0 0 10px red;
					opacity: 0.25;
				}
			</style>
		</template>
	</deluge-kit>

	<template id="sound">
		<deluge-sound editor="waveform">
			<template shadowrootmode="open" shadowrootclonable>
				<section id="handle">
					<button
						id="up"
						title="move sound up"
						label="move up"
						class="flat-button">
						↑
					</button>
					<div id="grabby">✣</div>
					<button
						id="down"
						title="move sound down"
						label="move down"
						class="flat-button">
						↓
					</button>
				</section>

				<header>
					<input id="name" type="text" />
				</header>

				<section id="controls">
					<label for="playmode">
						playmode
						<select id="playmode" label="playmode">
							<option value="gate">gate</option>
							<option value="oneshot">oneshot</option>
							<option value="group">group</option>
							<option value="loop">loop</option>
						</select>
					</label>

					<label>
						reverse
						<input id="reverse" type="checkbox" />
					</label>

					<div id="slot"></div>
					<div id="midi">c00</div>
				</section>

				<nav id="mode-selector">
					<button id="waveform">wav</button>
					<button id="envelope">env</button>
					<button id="mix">mix</button>
				</nav>

				<div id="editor">
					<deluge-waveform class="editor"></deluge-waveform>
					<deluge-envelope class="editor"></deluge-envelope>
					<deluge-mix class="editor"></deluge-mix>
				</div>

				<section id="meta">
					<button id="browse" class="flat-button">replace</button>
					<button id="audition" class="flat-button" label="audition">
						▶
					</button>
				</section>

				<button id="kill" class="flat-button">×</button>

				<style>
					* {
						box-sizing: border-box;
					}
					:host {
						border-radius: 0;
						box-shadow: 2px 2px var(--shadow);
						font-weight: bold;
						font-family: qp, monospace;
						display: grid;
						grid-template-areas:
							"handle header   header   header   modesel meta"
							"handle controls controls controls modesel meta"
							"handle controls controls controls modesel meta"
							"handle controls controls controls modesel meta"
							"handle controls controls controls modesel meta";
						position: relative;
						gap: 0px;
						padding: 0;
						--fill: black;
						--changed: var(--greem);
					}

					:host([editor]) {
						grid-template-areas:
							"handle header   header   header   modesel editor editor editor editor meta"
							"handle controls controls controls modesel editor editor editor editor meta"
							"handle controls controls controls modesel editor editor editor editor meta"
							"handle controls controls controls modesel editor editor editor editor meta"
							"handle controls controls controls modesel editor editor editor editor meta";
					}

					button {
						appearance: none;
					}

					#handle {
						grid-area: handle;
						background: var(--offset);
						color: var(--line);
						display: flex;
						flex-direction: column;
						text-align: center;
					}

					#handle button {
						cursor: pointer;
						color: currentcolor;
					}

					#handle > * {
						height: 33%;
						padding: var(--gap);
						box-shadow: none;
						border: none;
						background: transparent;

						font-size: 1rem;
					}

					#grabby {
						/* 						cursor: move; */
						line-height: 2em;
						color: transparent;
					}

					header {
						grid-area: header;
						display: flex;
						background: var(--fill);
						color: var(--line);
					}

					#midi {
						background: #222;
						color: #ccc;
						padding: 0 4px;
					}

					#slot {
						background: #111;
					}

					#name {
						flex: 1;
						border: none;
						font-family: var(--font-family);
						font-size: 1rem;
						height: 100%;
						background: var(--fill);
						color: var(--line);
					}

					#controls {
						grid-area: controls;
						display: grid;
						grid-template-columns: auto auto;
						grid-template-rows: auto auto;
						background: var(--fill);
						color: var(--line);
					}

					#controls label,
					#controls button {
						background: black;
						color: white;
						padding: 4px;
					}

					#controls .custom,
					#controls .custom select {
						background: color-mix(in srgb, #ffcc00 50%, var(--fill));
						color: white;
						display: none;
					}

					#loop-mode:has(> option[value="once"]:not(:checked)) {
						background-color: var(--changed);
					}
					#polyphonic:has(> option[value="auto"]:not(:checked)) {
						background-color: var(--changed);
					}
					#custom1:has(> option[value="pitch"]:not(:checked)) {
						background-color: var(--changed);
					}
					#custom2:has(> option[value="decimation"]:not(:checked)) {
						background-color: var(--changed);
					}
					#custom3:has(> option[value="bitcrush"]:not(:checked)) {
						background-color: var(--changed);
					}

					#controls label {
						display: flex;
						flex-direction: column;
						font-weight: normal;
						font-size: 0.8rem;
					}

					#mode-selector button,
					#controls button,
					#controls select {
						appearance: none;
						border: none;
						background: transparent;
						color: var(--line);
						cursor: pointer;
						font-family: var(--font-family);
						font-weight: bold;
						font-size: 0.9rem;
					}

					#controls [type="checkbox"] {
						appearance: none;
						border: none;
						font-family: var(--font-family);
						font-weight: bold;
						font-size: 1rem;
						background: transparent;
					}

					#controls [type="checkbox"]:before {
						display: block;
						content: "no";
					}

					#controls [type="checkbox"]:checked:before {
						display: block;
						content: "yes";
						background: var(--changed);
					}

					#controls #time-stretch:before {
						content: "linked";
					}

					#controls #time-stretch:checked:before {
						content: "independent";
						font-size: 0.7em;
						line-height: 1.8;
						background: var();
					}

					#controls #linear-interpolation:before {
						content: "sinc";
					}

					#controls #linear-interpolation:checked:before {
						content: "linear";
					}

					#mode-selector button,
					#controls button {
						background: var(--fill);
					}

					#editor {
						grid-area: editor;
						--waveform-fill: #000;
						--waveform-line: white;
						--waveform-off: #111;
						--waveform-start: #ccc;
						--waveform-end: #ccc;
						background: var(--waveform-fill);
						display: none;
					}

					:host([editor]) #editor {
						display: block;
					}

					#canvas {
						height: 100%;
					}

					#meta {
						grid-area: meta;
						display: flex;
						flex-direction: column;
						background: var(--line);
						color: var(--fill);
						gap: var(--gap);
					}

					#meta button {
						cursor: pointer;
						height: 50%;
						background: var(--fill);
						color: var(--line);
						border: none;
						font-family: var(--font-family);
					}

					#meta #browse {
						background: var(--offset);
					}

					#kill {
						position: absolute;
						top: 0;
						right: 0;
						height: 1rem;
						width: 1rem;
						transform: translate(50%, -50%);
						border-radius: 100%;
						background: #f60;
						color: white;
						border: 0;
						cursor: pointer;
					}

					#mode-selector {
						display: flex;
						flex-direction: column;
						grid-area: modesel;
						background: var(--sound-color);
						gap: 1px;
						padding: 1px;
					}

					#mode-selector button {
						flex: 1;
					}

					.editor {
						display: none;
					}

					:host([editor="waveform"]) deluge-waveform,
					:host([editor="envelope"]) deluge-envelope,
					:host([editor="mix"]) deluge-mix {
						display: block;
						width: 100%;
						height: 100%;
					}

					:host([editor="waveform"]) #waveform,
					:host([editor="envelope"]) #envelope,
					:host([editor="mix"]) #mix {
						background: #333;
					}

					#mode-selector #envelope {
						background: #f4ffee;
						display: none;
					}

					#meta #audition {
						color: black;
					}
				</style>
			</template>
		</deluge-sound>
	</template>

	<style id="global-styles">
		button,
		select {
			cursor: pointer;
			word-wrap: anywhere;
			color: var(--line);
			border: 1px solid var(--line);
			background: var(--offset);
			border-radius: var(--button-border-px);
			font-weight: bold;
			padding: 1em;
			box-shadow: var(--shadow-px) var(--shadow-px) var(--shadow);
			font-weight: bold;
			font-family: qp, monospace;
		}

		button:hover,
		select:hover {
			box-shadow: var(--heavy-shadow-px) var(--heavy-shadow-px)
				var(--heavy-shadow);
		}

		button:active,
		select:active {
			box-shadow: inset var(--shadow-px) var(--shadow-px) rgba(0, 0, 0, 0.2);
		}

		input {
			padding: 1em;
		}

		input[type="text"] {
			border: 1px solid;
			box-shadow: var(--shadow-px) var(--shadow-px) var(--shadow);
		}

		input[type="text"]:focus {
			box-shadow: var(--heavy-shadow-px) var(--heavy-shadow-px)
				var(--heavy-shadow);
			outline: 1px solid var(--green);
		}

		label > input {
			margin-top: 0.2rem;
		}
		#download {
			background: var(--greem);
			color: black;
		}
	</style>

	<audio
		class="iphone-silence"
		src="/aux/iphone-silence.flac"
		loop
		autoplay
		preload="auto"></audio>

	<script type="module" src="drum.js"></script>
</html>
